<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{master.html}">
<head>
    <meta charset="UTF-8"/>
    <title>Catálogo</title>
    <style layout:fragment="styles"> /* Added layout:fragment="styles" */
        .product-card-link:hover .card { /* Target the card inside the link on hover */
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1) !important; /* Aumenta la sombra */
            transition: all 0.2s ease-in-out;
        }
        /* Style for offer price (can reuse from list.html if defined globally) */
        .price-offer {
            color: #dc3545; /* Rojo */
            font-weight: bold;
        }
        .add-to-cart-form button {
             /* Ensures the button stays clickable */
            position: relative;
            z-index: 2;
        }
        .card-img-top {
            height: 180px;
            object-fit: cover; /* Changed from contain to cover for better fill */
        }
    </style>
</head>
<body>

<section layout:fragment="content" class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Catálogo</h2>
        <form class="d-flex" th:action="@{/catalogo}" method="get">
            <input type="search" name="q" class="form-control me-2" placeholder="Buscar por nombre o código" th:value="${q}">
            <button class="btn btn-primary" type="submit"><i class="fas fa-search"></i></button>
        </form>
    </div>

    <div th:if="${productosPage == null or productosPage.totalElements == 0}" class="alert alert-info">
        No hay productos disponibles que coincidan con la búsqueda.
    </div>

    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4" th:if="${productosPage != null and productosPage.totalElements > 0}">
        <div class="col" th:each="p : ${productosPage.content}">

            <a th:href="@{/catalogo/detalle/{id}(id=${p.id})}" class="text-decoration-none text-dark d-block h-100 product-card-link">
                <div class="card h-100 shadow-sm">

                    <img th:src="@{${p.getImagenPrincipalUrl()}}"
                         class="card-img-top"
                         alt="Foto producto">

                    <div class="card-body d-flex flex-column">
                        <h6 class="card-title" th:text="${p.nomPro}">Nombre Producto</h6>

                        <div class="mt-auto">
                            <div th:if="${p.precioOferta != null and p.precioOferta.compareTo(T(java.math.BigDecimal).ZERO) > 0 and p.precioOferta.compareTo(p.precio) < 0}">
                                <p class="mb-0 text-muted small" style="text-decoration: line-through;">
                                    S/ [[${#numbers.formatDecimal(p.precio, 1, 'COMMA', 2, 'POINT')}]]
                                </p>
                                <p class="mb-0 fw-bold price-offer">
                                    S/ [[${#numbers.formatDecimal(p.precioOferta, 1, 'COMMA', 2, 'POINT')}]]
                                </p>
                            </div>
                            <div th:unless="${p.precioOferta != null and p.precioOferta.compareTo(T(java.math.BigDecimal).ZERO) > 0 and p.precioOferta.compareTo(p.precio) < 0}">
                                <p class="mb-0 fw-bold">
                                    S/ [[${#numbers.formatDecimal(p.precio, 1, 'COMMA', 2, 'POINT')}]]
                                </p>
                            </div>
                            <small class="text-muted">Stock: [[${p.stock}]]</small>
                        </div>
                    </div> <div class="card-footer bg-transparent border-top-0 pt-0 pb-3">
                    <form th:action="@{/carrito/agregar}" method="post" class="add-to-cart-form"
                          onclick="event.stopPropagation(); return true;"> <input type="hidden" name="id" th:value="${p.id}" />
                        <input type="hidden" name="cantidad" value="1" /> <button type="submit" class="btn btn-sm btn-danger w-100">
                            <i class="fas fa-cart-plus me-1"></i> Agregar
                        </button>
                    </form>
                </div>

                </div> </a> </div> </div> <nav th:if="${productosPage != null and productosPage.totalPages > 1}" class="mt-4">
    <ul class="pagination justify-content-center">
        <li class="page-item" th:classappend="${productosPage.first}? 'disabled'">
            <a class="page-link" th:href="@{/catalogo(page=${productosPage.number - 1}, q=${q})}">Anterior</a>
        </li>

        <li class="page-item" th:each="i : ${#numbers.sequence(0, productosPage.totalPages - 1)}"
            th:classappend="${i == productosPage.number}? 'active'">
            <a class="page-link" th:href="@{/catalogo(page=${i}, q=${q})}" th:text="${i + 1}">1</a>
        </li>

        <li class="page-item" th:classappend="${productosPage.last}? 'disabled'">
            <a class="page-link" th:href="@{/catalogo(page=${productosPage.number + 1}, q=${q})}">Siguiente</a>
        </li>
    </ul>
</nav>

</section>

<div layout:fragment="scripts">
</div>

</body>
</html>